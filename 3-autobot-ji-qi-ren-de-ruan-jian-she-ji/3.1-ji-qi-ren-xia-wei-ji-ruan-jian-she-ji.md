# 3.1 机器人下位机软件设计

## 3.1.1 基于FreeRTOS操作系统的程序框架设计

在第2章内，经过对比与分析，选定了单片机STM32F407VGT6作为下位机主控。stm32单片机的常规程序结构为通过定时器中断或外部中断等修改标志位，主循环内通过标志位的修改执行不同的计算任务。这种程序结构实时性较差，中断的回调函数内容易阻塞，通过人工指定标志位实现的轮询调度系统能在一定程度上缓解程序阻塞，但整体效率有限。

嵌入式实时操作系统是能运行在单片机中的轻量操作系统，一般的嵌入式实时操作系统都具有低功耗、实时性强、低成本等优势。FreeRTOS系统是一款开源免费的实时操作系统，具有较强的实时特性与可靠性，对比自定义的轮询调度系统在效率上有极大的提高。通过FreeRTOS的封装，对任务调度、内存管理、中断管理等程序的执行效率有明显的提高。通过ST公司开发的STM32CubeMX能更便捷的配置基于HAL库的FreeRTOS系统。

在上一节说明了机器人下位机需要实现的功能，根据以上功能，在FreeRTOS系统中定义程序框架图如下：

## 3.1.2 电机控制程序设计

## 3.1.5 电机控制程序设计

